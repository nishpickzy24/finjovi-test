<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>Download Your NASDAQ 100 Data - Finjovi</title>
    <meta name="description" content="Download your purchased 20-year historical stock data for NASDAQ 100 companies in CSV format.">
    
    <!-- Open Graph tags -->
    <meta property="og:title" content="Download Your NASDAQ 100 Data - Finjovi">
    <meta property="og:description" content="Access your purchased 20-year historical stock data for all NASDAQ 100 companies in CSV format.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://finjovi.com/download">
    
    <!-- Twitter Card tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Download Your NASDAQ 100 Data">
    <meta name="twitter:description" content="Access your purchased 20-year historical data for all NASDAQ 100 stocks in CSV format.">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom CSS -->
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .loading-spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
        }
        
        .toast.success {
            border-left: 4px solid #10b981;
        }
        
        .toast.error {
            border-left: 4px solid #ef4444;
        }
        
        .stock-card {
            transition: all 0.3s ease;
        }
        
        .stock-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .user-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg id="toast-icon" class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div class="ml-3">
                <p id="toast-title" class="text-sm font-medium text-gray-900"></p>
                <p id="toast-message" class="text-sm text-gray-500"></p>
            </div>
        </div>
    </div>

    <!-- User Info Bar -->
    <div class="user-info py-3">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span id="user-email">Loading...</span>
                </div>
                <button 
                    id="logout-btn" 
                    onclick="logout()"
                    class="inline-flex items-center px-3 py-1 border border-white border-opacity-30 rounded-md text-sm font-medium text-white bg-white bg-opacity-20 hover:bg-opacity-30 transition-colors"
                >
                    <svg class="mr-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    Logout
                </button>
            </div>
        </div>
    </div>

    <div class="py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">Your NASDAQ 100 Data</h1>
                <p class="text-xl text-gray-600 mb-8">
                    Download your 20-year historical stock data in CSV format
                </p>
                
                <!-- Download All Button -->
                <button 
                    id="download-all-btn"
                    onclick="downloadBundle()"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 text-lg font-semibold rounded-md inline-flex items-center mb-8 transition-colors"
                >
                    <svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <span id="download-all-text">Download All Stocks (ZIP)</span>
                </button>
            </div>

            <!-- Search and Filter -->
            <div class="bg-white rounded-lg shadow mb-8 p-6">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="relative flex-1">
                        <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input
                            type="text"
                            id="search-input"
                            placeholder="Search by symbol or company name..."
                            class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            oninput="filterStocks()"
                        />
                    </div>
                    <select
                        id="sector-filter"
                        class="w-full md:w-48 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        onchange="filterStocks()"
                    >
                        <option value="all">All Sectors</option>
                    </select>
                </div>
            </div>

            <!-- Results Count -->
            <div class="mb-6">
                <p id="results-count" class="text-gray-600">Loading stocks...</p>
            </div>

            <!-- Stock Grid -->
            <div id="stock-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Stocks will be loaded here -->
            </div>

            <!-- No Results -->
            <div id="no-results" class="text-center py-12 hidden">
                <p class="text-gray-500 text-lg">No stocks found matching your criteria.</p>
            </div>

            <!-- Data Information -->
            <div class="bg-white rounded-lg shadow mt-12 p-6">
                <h3 class="text-lg font-semibold mb-4">Data Specifications</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-2">Data Coverage</h4>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>• 20 years of historical data</li>
                            <li>• End of day stock prices</li>
                            <li>• Splits and dividends adjusted</li>
                            <li>• Daily OHLCV format</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">File Format</h4>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>• CSV format for easy import</li>
                            <li>• Standard date formatting</li>
                            <li>• Compatible with Excel, Python, R</li>
                            <li>• Individual files per stock</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-4 gap-8">
                <div class="md:col-span-2">
                    <div class="flex items-center mb-4">
                        <svg class="h-8 w-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <h3 class="ml-2 text-xl font-bold">Finjovi</h3>
                    </div>
                    <p class="text-gray-300 mb-4">
                        Professional-grade historical stock data for NASDAQ 100 companies. 
                        Empowering traders, analysts, and researchers with premium market data.
                    </p>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">Quick Links</h4>
                    <ul class="space-y-2">
                        <li><a href="#features" class="text-gray-300 hover:text-white">Features</a></li>
                        <li><a href="#stocks" class="text-gray-300 hover:text-white">Stocks</a></li>
                        <li><a href="#pricing" class="text-gray-300 hover:text-white">Pricing</a></li>
                        <li><a href="#contact" class="text-gray-300 hover:text-white">Contact</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">Contact</h4>
                    <div class="space-y-2">
                        <p class="text-gray-300">Email:</p>
                        <a href="mailto:support@finjovi.com" class="text-blue-400 hover:text-blue-300">support@finjovi.com</a>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-8 pt-8 text-center">
                <p class="text-gray-400">&copy; 2024 Finjovi. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Authentication check
        function checkAuth() {
            const sessionData = localStorage.getItem('finjovi_session');
            if (!sessionData) {
                window.location.href = '/login';
                return false;
            }

            try {
                const session = JSON.parse(sessionData);
                const now = new Date();
                const expiresAt = new Date(session.expiresAt);

                if (now > expiresAt) {
                    localStorage.removeItem('finjovi_session');
                    showToast('Session expired. Please login again.', 'error');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 1000);
                    return false;
                }

                // Update user info
                document.getElementById('user-email').textContent = session.email;
                return true;
            } catch (error) {
                localStorage.removeItem('finjovi_session');
                window.location.href = '/login';
                return false;
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem('finjovi_session');
            showToast('Logged out', 'success');
            setTimeout(() => {
                window.location.href = '/login';
            }, 500);
        }

             function showToast(message, type = 'success', title = '') {
            const toast = document.getElementById('toast');
            const toastTitle = document.getElementById('toast-title');
            const toastMessage = document.getElementById('toast-message');
            const toastIcon = document.getElementById('toast-icon');

            // Set content
            toastTitle.textContent = title || (type === 'success' ? 'Success' : 'Error');
            toastMessage.textContent = message;

            // Set styling
            toast.className = `toast ${type}`;
            toastIcon.className = `h-5 w-5 ${type === 'success' ? 'text-green-500' : 'text-red-500'}`;

            // Show toast
            toast.style.display = 'block';

            // Auto hide after 5 seconds
            setTimeout(() => {
                toast.style.display = 'none';
            }, 5000);
        }

        // Check authentication on page load
        if (!checkAuth()) {
            // Redirect handled in checkAuth
        }

        // Embedded stock data - same as home page
        const allStocks = [
            { id: 1, symbol: 'AAPL', company: 'Apple Inc.', sector: 'Technology', price: 182.52, change: 2.34, marketCap: '$2.8T', description: 'Designs and manufactures consumer electronics, software, and services' },
            { id: 2, symbol: 'MSFT', company: 'Microsoft Corporation', sector: 'Technology', price: 378.85, change: -1.23, marketCap: '$2.8T', description: 'Develops and supports software, services, devices, and solutions' },
            { id: 3, symbol: 'AMZN', company: 'Amazon.com Inc.', sector: 'Consumer', price: 144.05, change: 0.89, marketCap: '$1.5T', description: 'Online retail and cloud computing services' },
            { id: 4, symbol: 'GOOGL', company: 'Alphabet Inc. Class A', sector: 'Communication', price: 138.21, change: 1.45, marketCap: '$1.7T', description: 'Search engine, advertising, and cloud computing services' },
            { id: 5, symbol: 'GOOG', company: 'Alphabet Inc. Class C', sector: 'Communication', price: 139.69, change: 1.52, marketCap: '$1.7T', description: 'Search engine, advertising, and cloud computing services' },
            { id: 6, symbol: 'NVDA', company: 'NVIDIA Corporation', sector: 'Technology', price: 875.28, change: 15.67, marketCap: '$2.1T', description: 'Graphics processing units and AI computing platforms' },
            { id: 7, symbol: 'TSLA', company: 'Tesla Inc.', sector: 'Consumer', price: 248.42, change: -3.21, marketCap: '$789B', description: 'Electric vehicles and clean energy solutions' },
            { id: 8, symbol: 'META', company: 'Meta Platforms Inc.', sector: 'Communication', price: 484.20, change: 7.85, marketCap: '$1.2T', description: 'Social media platforms and virtual reality technologies' },
            { id: 9, symbol: 'AVGO', company: 'Broadcom Inc.', sector: 'Technology', price: 1341.78, change: 12.45, marketCap: '$625B', description: 'Semiconductor and infrastructure software solutions' },
            { id: 10, symbol: 'COST', company: 'Costco Wholesale Corporation', sector: 'Consumer', price: 804.12, change: 4.67, marketCap: '$357B', description: 'Membership-based warehouse club retail' },
            { id: 11, symbol: 'NFLX', company: 'Netflix Inc.', sector: 'Communication', price: 622.84, change: -2.15, marketCap: '$275B', description: 'Streaming entertainment and content production' },
            { id: 12, symbol: 'ADBE', company: 'Adobe Inc.', sector: 'Technology', price: 567.31, change: 8.92, marketCap: '$256B', description: 'Digital media and creative software solutions' },
            { id: 13, symbol: 'PEP', company: 'PepsiCo Inc.', sector: 'Consumer', price: 167.89, change: 0.75, marketCap: '$231B', description: 'Food and beverage manufacturing' },
            { id: 14, symbol: 'TMUS', company: 'T-Mobile US Inc.', sector: 'Communication', price: 180.45, change: 2.13, marketCap: '$213B', description: 'Wireless telecommunications services' },
            { id: 15, symbol: 'CSCO', company: 'Cisco Systems Inc.', sector: 'Technology', price: 54.78, change: 1.23, marketCap: '$225B', description: 'Networking hardware and software solutions' },
            { id: 16, symbol: 'AMGN', company: 'Amgen Inc.', sector: 'Healthcare', price: 289.34, change: -1.87, marketCap: '$158B', description: 'Biotechnology and pharmaceutical products' },
            { id: 17, symbol: 'QCOM', company: 'Qualcomm Inc.', sector: 'Technology', price: 173.62, change: 3.45, marketCap: '$195B', description: 'Wireless telecommunications and semiconductor products' },
            { id: 18, symbol: 'INTC', company: 'Intel Corporation', sector: 'Technology', price: 43.21, change: -0.98, marketCap: '$181B', description: 'Semiconductor manufacturing and technology' },
            { id: 19, symbol: 'CMCSA', company: 'Comcast Corporation', sector: 'Communication', price: 42.85, change: 0.67, marketCap: '$176B', description: 'Cable television and internet services' },
            { id: 20, symbol: 'TXN', company: 'Texas Instruments Inc.', sector: 'Technology', price: 189.75, change: 2.34, marketCap: '$173B', description: 'Semiconductor design and manufacturing' }
        ];

        let filteredStocks = [...allStocks];

        // Toast functionality
   
        // Initialize page
        function initializePage() {
            populateSectorFilter();
            renderStocks();
            updateResultsCount();
        }

        // Populate sector filter
        function populateSectorFilter() {
            const sectorFilter = document.getElementById('sector-filter');
            const sectors = [...new Set(allStocks.map(stock => stock.sector))].sort();
            
            sectors.forEach(sector => {
                const option = document.createElement('option');
                option.value = sector.toLowerCase();
                option.textContent = sector;
                sectorFilter.appendChild(option);
            });
        }

        // Filter stocks
        function filterStocks() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const selectedSector = document.getElementById('sector-filter').value;

            filteredStocks = allStocks.filter(stock => {
                const matchesSearch = stock.symbol.toLowerCase().includes(searchTerm) || 
                                    stock.company.toLowerCase().includes(searchTerm);
                const matchesSector = selectedSector === 'all' || stock.sector.toLowerCase() === selectedSector;
                
                return matchesSearch && matchesSector;
            });

            renderStocks();
            updateResultsCount();
        }

        // Render stocks
        function renderStocks() {
            const stockGrid = document.getElementById('stock-grid');
            const noResults = document.getElementById('no-results');

            if (filteredStocks.length === 0) {
                stockGrid.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }

            noResults.classList.add('hidden');

            stockGrid.innerHTML = filteredStocks.map(stock => `
                <div class="stock-card bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">${stock.symbol}</h3>
                            <p class="text-sm text-gray-600 mt-1">${stock.company}</p>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${stock.sector}
                        </span>
                    </div>
                    
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <p class="text-2xl font-bold text-gray-900">$${stock.price.toFixed(2)}</p>
                            <p class="text-sm ${stock.change >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)}
                            </p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-500">Market Cap</p>
                            <p class="text-sm font-semibold text-gray-900">${stock.marketCap}</p>
                        </div>
                    </div>
                    
                    <p class="text-sm text-gray-600 mb-4">${stock.description}</p>
                    
                    <button 
                        onclick="downloadStock('${stock.symbol}')" 
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors inline-flex items-center justify-center"
                    >
                        <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Download CSV
                    </button>
                </div>
            `).join('');
        }

        // Update results count
        function updateResultsCount() {
            const resultsCount = document.getElementById('results-count');
            const total = allStocks.length;
            const filtered = filteredStocks.length;
            
            if (filtered === total) {
                resultsCount.textContent = `Showing all ${total} stocks`;
            } else {
                resultsCount.textContent = `Showing ${filtered} of ${total} stocks`;
            }
        }

        // Download individual stock
        function downloadStock(symbol) {
            const stock = allStocks.find(s => s.symbol === symbol);
            if (!stock) return;

            // Generate sample CSV data
            const csvData = generateSampleCSV(symbol);
            const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `${symbol}_20_year_data.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showToast(`Downloaded ${symbol} data successfully`, 'success');
            }
        }

        // Download bundle

          async function downloadBundle() {
    const session = JSON.parse(localStorage.getItem('finjovi_session') || '{}');
    const token = session?.accessToken;

    const btn = document.getElementById('download-all-btn');
    const label = document.getElementById('download-all-text');

    if (!token) {
      window.location.href = "/login";
      return;
    }

    try {
      // Show preparing state
      btn.disabled = true;
      label.textContent = "Preparing...";

    const response = await fetch("https://finjovi-backend.onrender.com/download-zip", {
        method: "GET",
        headers: {
          Authorization: "Bearer " + token
        }
      });

      if (!response.ok) throw new Error("Unauthorized or failed");

      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "historicalData.zip";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);

    //   showToast('ZIP Download started!', 'success');
    } catch (err) {
      console.error("Download error:", err);
    //   alert("Download failed or unauthorized.");
     showToast('Zip Download failed ', 'error');

    } finally {
      label.textContent = "Download All Stocks (ZIP)";
      btn.disabled = false;
    }
  }
        // Generate sample CSV data
        function generateSampleCSV(symbol) {
            const headers = 'Date,Open,High,Low,Close,Volume\n';
            const sampleData = [];
            
            // Generate 20 sample rows
            for (let i = 0; i < 20; i++) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const basePrice = Math.random() * 100 + 50;
                const open = basePrice + (Math.random() - 0.5) * 2;
                const close = basePrice + (Math.random() - 0.5) * 2;
                const high = Math.max(open, close) + Math.random() * 2;
                const low = Math.min(open, close) - Math.random() * 2;
                const volume = Math.floor(Math.random() * 1000000) + 100000;
                
                sampleData.push(`${dateStr},${open.toFixed(2)},${high.toFixed(2)},${low.toFixed(2)},${close.toFixed(2)},${volume}`);
            }
            
            return headers + sampleData.join('\n');
        }

        // Initialize page when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializePage);

    //        document.addEventListener("contextmenu", event => event.preventDefault());
    // document.addEventListener("keydown", function (e) {
    //   if (e.key === "F12" || 
    //       (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
    //       (e.ctrlKey && e.key === "u")) {
    //     e.preventDefault();
    //   }
    // });
    </script>
</body>
</html>
